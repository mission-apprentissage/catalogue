const _ = require("lodash");
const mongoose = require("mongoose");
var { ObjectId } = mongoose.Types;
const { randomSIRET } = require("./testUtils");
const { Formation, Establishment } = require("../../common/models");

module.exports = {
  createFormation: (options = {}) => {
    let id = ObjectId();
    let siret = randomSIRET();

    return new Formation(
      _.merge(
        {
          _id: id,
          etablissement_formateur_id: id,
          etablissement_formateur_siret: siret,
          etablissement_formateur_siret_intitule: "Organisme Formation Apprentissage",
          etablissement_formateur_uai: "1111111X",
          etablissement_formateur_type: "CFA",
          etablissement_formateur_conventionne: "OUI",
          etablissement_formateur_declare_prefecture: "OUI",
          etablissement_formateur_datadock: "datadocké",
          etablissement_formateur_published: true,
          etablissement_responsable_id: id,
          etablissement_responsable_siret: siret,
          etablissement_responsable_siret_intitule: "Organisme Formation Apprentissage",
          etablissement_responsable_uai: "1111111E",
          etablissement_responsable_type: "CFA",
          etablissement_responsable_conventionne: "OUI",
          etablissement_responsable_declare_prefecture: "OUI",
          etablissement_responsable_datadock: "datadocké",
          etablissement_responsable_published: true,
          etablissement_reference: "responsable",
          etablissement_reference_id: id,
          etablissement_reference_type: "CFA",
          etablissement_reference_conventionne: "OUI",
          etablissement_reference_declare_prefecture: "OUI",
          etablissement_reference_datadock: "datadocké",
          etablissement_reference_published: true,
          siren: "222222222",
          nom_academie: "Besançon",
          num_academie: 3,
          nom_academie_siege: "Besançon",
          num_academie_siege: 3,
          code_postal: "25200",
          code_commune_insee: "25284",
          num_departement: "25",
          ds_id_dossier: "1284758",
          uai_formation: "1111111F",
          nom: "CAP Menuisier fabricant",
          intitule: "Menuisier fabricant",
          diplome: "Certificat d’Aptitude Professionnelle (CAP)",
          niveau: "3 (CAP...)",
          educ_nat_code: "",
          rncp_code: false,
          rncp_eligible_apprentissage: false,
          rncp_etablissement_formateur_habilite: false,
          rncp_etablissement_responsable_habilite: false,
          rncp_etablissement_reference_habilite: false,
          rome_codes: [],
          periode: '["Janvier","Février","Mars","Avril","Mai","Septembre","Octobre","Novembre","Décembre"]',
          capacite: "16",
          email: "formation@organisme.fr",
          parcoursup_reference: "NON",
          info_bcn_code_en: 1,
          info_bcn_intitule: 0,
          info_bcn_niveau: null,
          info_bcn_diplome: null,
          computed_bcn_code_en: "Non trouvé",
          computed_bcn_intitule: "Erreur",
          computed_bcn_niveau: "",
          computed_bcn_diplome: "",
          source: "TEST",
          commentaires: "",
          last_modification: "",
          to_verified: false,
          published_old: true,
          published: false,
          created_at: new Date(),
          last_update_at: new Date(),
          __v: 0,
        },
        options
      )
    );
  },
  createEstablishment: (options = {}) => {
    let siret = randomSIRET();
    let siren = siret.substring(0, 9);

    return new Establishment(
      _.merge(
        {
          siret: siret,
          siren: siren,
          numero_tva_intracommunautaire: `FR26${siren}`,
          naf_code: "8532Z",
          naf_libelle: "Enseignement secondaire technique ou professionnel",
          code_effectif_entreprise: "22",
          forme_juridique_code: "7331",
          forme_juridique: "Établissement public local d'enseignement",
          raison_sociale: "Organisme Formation Apprentissage",
          nom_commercial: "TEST",
          capital_social: "",
          date_creation: "1970-04-24T00:00:00.000+00:00",
          siret_siege_social: `${siren}00024`,
          siege_social: false,
          adresse: "32 rue des Lilas 75001 Paris",
          complement_adresse: "",
          numero_voie: "32",
          type_voie: "RUE",
          nom_voie: "DES LILAS",
          code_postal: "75001",
          localite: "Paris",
          code_insee_localite: "75001",
          num_academie: 4,
          nom: "",
          prenom: "",
          ds_id_dossier: "1111111",
          ds_questions_siren: "111111111",
          ds_questions_nom: "Robert Dupont",
          ds_questions_email: "formation@organisme.fr",
          ds_questions_uai: "0000000J",
          ds_questions_has_agrement_cfa: "true",
          ds_questions_has_certificaton_2015: "false",
          ds_questions_has_ask_for_certificaton: "false",
          ds_questions_ask_for_certificaton_date: "",
          ds_questions_declaration_code: "1111P00XXXX",
          ds_questions_has_2020_training: "true",
          uai: "1111111J",
          uais_formations: ["2222222J", "3333333F"],
          info_depp: 1,
          info_dgefp: 1,
          info_datagouv_ofs: 0,
          info_datadock: 2,
          computed_type: "CFA",
          computed_declare_prefecture: "OUI",
          computed_conventionne: "OUI",
          computed_info_datadock: "datadocké",
          published: true,
          created_at: new Date(),
          last_update_at: new Date(),
          __v: 0,
        },
        options
      )
    );
  },
};
